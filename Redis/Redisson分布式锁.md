Redisson分布式锁采用了 hash 结构，key为锁名称，字段名为uuid+threadId，值为可重入次数。

通过redis Channel 解锁订阅机制，当锁释放时可以及时知道，并参与抢占，防止无效的轮询而浪费资源。

当资源可用用的时候，循环去尝试获取锁，由于多个线程同时去竞争资源，所以这里用了信号量，对于同一个资源只允许一个线程获得锁，其它的线程阻塞。

使用watchDog机制实现锁的续期，比较靠谱，无业务入侵。当加锁成功后，同时开启守护线程，默认有效期是30秒，每隔10秒就会给锁续期到30秒，只要持有锁的客户端没有宕机，就能保证一直持有锁，直到业务代码执行完毕由客户端自己解锁，如果宕机了自然就在有效期失效后自动解锁。

`lockWatchdogTimeout（监控锁的看门狗超时，单位：毫秒）`

1.watchDog 只有在未显示指定加锁时间时才会生效。（这点很重要）

2.lockWatchdogTimeout设定的时间不要太小 ，比如我之前设置的是 100毫秒，由于网络直接导致加锁完后，watchdog去延期时，这个key在redis中已经被删除了。

Redisson 提供了可重入锁、公平锁、联锁、红锁、分段锁等其他各种场景的锁。











[Redis分布式锁 （图解-秒懂-史上最全）](https://www.cnblogs.com/crazymakercircle/p/14731826.html)