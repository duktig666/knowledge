# 第一篇 基础篇

## 第一章 绪论

### 第一节 数据库系统概述

#### 1.数据

> 描述事物的符号记录称为数据。数据的含义称为数据的语义，数据与其语义是不可分的。

#### 2.数据库

> 数据库是长期储存在计算机内、有组织的、可共享的大量数据的集合。数据库中的数据按一定的数据模型组织、描述和储存，具有较小的冗余度(redundancy)、较高的数据独立性（data independency）和易扩展性（scalability)，并可为各种用户共享。

数据库数据具有==永久存储==、==有组织==和==可共享==三个基本特点。

#### 3. 数据库管理系统

**解决的问题**：如何科学地组织和存储数据，如何高效地获取和维护数据。完成这个任务的是一个系统软件—数据库管理系统。

> 数据库管理系统是位于用户与操作系统之间的一层数据管理软件。数据库管理系统和操作系统一样是计算机的基础软件，也是一个大型复杂的软件系统。
>
> 数据库是长期存储在计算机内有组织、大量、共享的数据集合。它可以供各种用户共享，具有最小冗余度和较高的数据独立性。数据库管理系统在数据库建立、运用和维护时对数据库进行统一控制，以保证数据的完整性和安全性，并在多用户同时使用数据库时进行并发控制，在发生故障后对数据库讲行恢复。

##### 主要功能包括：

（1）==数据定义功能== 数据库管理系统提供数据定义语言（Data Definition Language，DDL），用户通过它可以方便地对数据库中的数据对象的组成与结构进行定义。**定义数据对象的组成和结构**

（2）==数据组织、存储和管理== 数据库管理系统要分类组织、存储和管理各种数据，包括数据字典、用户数据、数据的存取路径等。要确定以何种文件结构和存取方式在存储级上组织这些数据，如何实现数据之间的联系。数据组织和存储的基本目标是提高存储空间利用率和方便存取，提供多种存取方法（如索引查找、hash查找、顺序查找等）来提高存取效率。 
（3）==数据操纵功能== 数据库管理系统还提供数据操纵语言(Data Manipulation Language，DML)，用户可以使用它操纵数据，实现对数据库的基本操作，如查询、插入、删除和修改等。 **增删改查**
（4）==数据库的事务管理和运行管理== 数据库在建立、运用和维护时由数据库管理系统统一管理和控制，以**保证事务的正确**
**运行，保证数据的安全性、完整性、多用户对数据的并发使用及发生故障后的系统恢复。**

（5）==数据库的建立和维护功能== 数据库的建立和维护功能包括数据库初始数据的输入、转换功能，数据库的转储、恢
复功能，数据库的重组织功能和性能监视、分析功能等。这些功能通常是由一些实用程序或管理工具完成的。
（6）==其他功能== 其他功能包括数据库管理系统与网络中其他软件系统的通信功能，一个数据库管理系统与另一个数据库管理系统或文件系统的数据转换功能，异构数据库之间的互访和互操作功能等。

#### 4.数据库系统

> 数据库系统是由数据库、数据库管理系统（及其应用开发工具）、应用程序和数据库管理员（DataBase Administrator，DBA）组成的存储、管理、处理和维护数据的系统。


数据库提供数据的存储功能

数据库管理系统提供数据的组织、存取、管理和维护等基础功能

数据库应用系统根据应用需求使用数据库

数据库管理员负责全面管理数据库系统。



![image-20200726101243827](https://gitee.com/koala010/typora/raw/master/img/image-20200726101243827.png)

![image-20200726101304792](https://gitee.com/koala010/typora/raw/master/img/image-20200726101304792.png)

#### 5. 数据管理技术的产生和发展

![image-20200726102429055](https://gitee.com/koala010/typora/raw/master/img/image-20200726102429055.png)



#### 6.数据库系统的特点

##### **1.数据结构化**

数据库系统实现整体数据的结构化，这是数据库的主要特征之一，也是数据库系统与文件系统的本质区别。

###### 整体结构化的理解：

所谓“整体”结构化是指数据库中的数据不再仅仅针对某一个应用，而是面向整个组织或企业;不仅数据内部是结构化的，而且整体是结构化的，数据之间是具有联系的。

也就是说，不仅要考虑某个应用的数据结构，还要考虑整个组织的数据结构。

*在数据库系统中，不仅数据是整体结构化的，而且存取数据的方式也很灵活，可以存取数据库中的某一个或一组数据项、一个记录或一组记录;**而在文件系统中，数据的存取单位是记录，粒度不能细到数据项**。*

##### 2．数据的共享性高、冗余度低且易扩充

数据库系统从整体角度看待和描述数据，数据不再面向某个应用而是面向整个系统，因此数据可以被多个用户、多个应用共享使用。数据共享可以大大减少数据冗余，节约存储空间。数据共享还能够避免数据之间的不相容性与不一致性。

不仅可以被多个应用共享使用，而且容易增加新的应用，这就使得数据库系统弹性大，易于扩充，可以适应各种用户的要求。可以
选取整体数据的各种子集用于不同的应用系统，当应用需求改变或增加时，只要重新选取不同的子集或加上一部分数据便可以满足新的需求。

##### 3．数据独立性高

###### 物理独立性

物理独立性是指用户的应用程序与数据库中数据的物理存储是相互独立的。也就是说，数据在数据库中怎样存储是由数据库管理系统管理的，用户程序不需要了解，应用程序要处理的只是数据的逻辑结构，这样当数据的物理存储改变时应用程序不用改变。

###### 逻辑独立性

逻辑独立性是指用户的应用程序与数据库的逻辑结构是相互独立的。也就是说，数据的逻辑结构改变时用户程序也可以不变。

数据独立性是由数据库管理系统提供的==二级映像==功能来保证的。

##### 4数据由数据库管理系统统一管理和控制

数据库的共享，会带来并发问题，造成数据安全隐患。

###### 数据库管理系统的数据控制功能：

（1）==数据的安全性（security）保护==  保护数据以防止不合法使用造成的数据泄密和破坏。每个用户只能
按规定对某些数据以某些方式进行使用和处理。
（2）==数据的完整性（integrity）检查== 数据的完整性指数据的正确性、有效性和相容性。完整性检查将数据控制在有效的范
围内，并保证数据之间满足一定的关系。
（3）==并发（concurrency）控制==  当多个用户的并发进程同时存取、修改数据库时，可能会发生相互千扰而得到错误的
结果或使得数据库的完整性遭到破坏，因此必须对多用户的并发操作加以控制和协调。
（4）==数据库恢复（recovery）== 数据库管理系统必须具有将数据库从错误状态恢复到某一已知的正确状态（亦称为完整状态或一致状态）的功能，这就是数据库的恢复功能。



*数据库系统的出现使信息系统从==以加工数据的程序为中心==转向==围绕共享的数据库为中心==的新阶段。*



### 第二节 数据模型

#### 1.数据模型

> 数据模型（data model）也是一种模型，它是对现实世界数据特征的抽象。也就是说数据模型是用来描述数据、组织数据和对数据进行操作的。

==数据模型==是数据库系统的核心和基础。

#### 2.两类数据模型

##### 数据模型应满足三方面要求

1. 能比较真实地模拟现实世界

2. 容易为人所理解
3. 便于在计算机上实现

**第一类是概念模型，**也称信息模型，它是按用户的观点来对数据和信息建模，主要用于数据库设计。

**第二类是逻辑模型和物理模型**，它是按计算机系统的观点对数据建模，主要用于数据库管理系统的实现。

##### 将现实世界抽象为信息世界，然后将信息世界转换为机器世界

![image-20200726110710756](https://gitee.com/koala010/typora/raw/master/img/image-20200726110710756.png)



#### 3.概念模型

##### 实体（entity）

> 客观存在并可相互区别的事物称为实体

##### 属性（attribute）

> 实体所具有的某一特性称为属性

##### 码（key主键）

> 唯一标识实体的属性集称为码

##### 实体型（entity type）

> 具有相同属性的实体必然具有共同的特征和性质。**用实体名及其属性名集合来抽象和刻画同类实体，称为实体型**。例如，学生（学号，姓名，性别，出生年月，所在院系，入学时间）就是一个实体型。

##### 实体集（entity set）

同一类型实体的集合称为实体集。例如，全体学生就是一个实体集。

##### 联系（relationship）

在现实世界中，事物内部以及事物之间是有联系的，这些联系在信息世界中反映为实体（型）内部的联系和实体（型）之间的联系。实体内部的联系通常是指组成实体的各属性之间的联系，实体之间的联系通常是指不同实体集之间的联系。
实体之间的联系有==一对一==、==一对多==和==多对多==等多种类型。

#### 4.数据模型通常由==数据结构==、==数据操作==和==数据的完整性约束条件==三部分组成。

#### 5.逻辑模型的分类

#### 6.层次模型的定义、特点、优缺点、代表

#### 7.网状模型的代表、定义、特点、优缺点

#### 8.关系模型的术语

##### 关系

##### 元组

##### 属性

##### 码

##### 域

##### 分量

##### 关系模式

![image-20200726145954241](https://gitee.com/koala010/typora/raw/master/img/image-20200726145954241.png)

#### 9.关系模型的优缺点



### 第三节 数据库系统的结构

#### 1.型和值

#### 2.三级模式结构

数据库系统的三级模式结构是指数据库系统是由==外模式==、==模式==和==内模式==三级构成。

![image-20200726151016349](https://gitee.com/koala010/typora/raw/master/img/image-20200726151016349.png)

##### 理解模式、外模式和内模式

#### 3.二级映像功能和数据独立性

##### 外模式/模式映像——逻辑独立性

##### 模式/内模式映像——物理独立性

#### 

### 第四节 数据库系统的组成

#### 1.组成

#### 2.数据库管理员的职责



## 第二章 关系数据库

### 第一节 关系数据结构及形式化定义

#### 1.关系

单一数据结构——关系，逻辑结构为一张扁平的二维表。

#### 2.域

#### 3.笛卡尔积

#### 4.关系模式的三种类型：基本关系（基本表、基表）、查询表、视图表

#### 5.关系作为关系数据结构时的限定和扩充

#### 6.==基本关系的6个性质==

#### 7.关系模式是型，关系是值

#### 8.关系的描述称为关系模式

#### 9.关系数据库

### 第二节 关系操作

#### 1.查询操作的基本操作

选择、投影、并、差、笛卡儿积是5种基本操作

#### 2.SQL,结构化查询语言（Structured Query Language）

> SQL 不仅具有丰富的查询功能，而且具有数据定义和数据控制功能，是集查询、数据定义语言、数据操纵语言和数据控制语言（Data Control Language，DCL）于一体的关系数据语言。它充分体现了关系数据语言的特点和优点，是关系数据库的标准语言。

#### 3.关系数据语言的分类

![image-20200727103252308](https://gitee.com/koala010/typora/raw/master/img/20200727103252.png)

### 第三节 关系的完整性

#### 1.关系模型中有三类完整性约束:实体完整性（entity integrity)、参照完整性（referential
integrity）和用户定义的完整性(user-defined integrity)。

#### 2.实体完整性保证每个元组可区分。

#### 3.实体完整性的规则

#### 4.理解外码与参照完整性

#### 5.主码与外码必须在同一个域上

#### 6.参照完整性规则就是定义外码与主码之间的引用规则。

#### 7.用户定义的完整性



### 第四节 关系代数

#### 1.关系代数是一种抽象的查询语言，它用对关系的运算来表达查询。

#### 2.运算对象、运算符、运算结果是运算的三大要素。

#### 3.关系代数的运算按运算符的不同可分为传统的集合运算和专门的关系运算两类。

![image-20200727105042967](https://gitee.com/koala010/typora/raw/master/img/20200727105043.png)

#### 4.理解专门的关系运算符

##### 选择

选择又称为限制（restriction)。它是在关系R中选择满足给定条件的诸元组

##### 投影

关系R上的投影是从R中选择出若干属性列组成新的关系。

##### 连接

连接也称为0连接。它是从两个关系的笛卡儿积中选取属性间满足一定条件的元组。

##### 除

设关系R除以关系S的结果为关系T，则T包含所有在R但不在S中的属性及其值，且T的元组与S的元组的所有组合都在R中。

#### 5.理解等值连接与自然连接、外连接（左外连接和右外连接）

如果把悬浮元组也保存在结果关系中，而在其他属性上填空值（NULL)，那么这种连接就叫做外连接（outer join)，记作RS;

#### 6.悬浮元祖

自然连接被舍弃的元组成为自然元组（两表公共属性不相等，被舍弃）

#### 

### ==第五节 关系演算==

#### 1.关系演算

> 关系演算是以数理逻辑中的谓词演算为基础的。按谓词变元的不同，关系演算可分为==元组关系演算==和==域关系演算==。

#### 2.元组关系演算语言ALPHA

- 元组变量相当于mysql的别名
- 查询操作
- 更新操作

#### 3.元组关系演算

##### 三类原子公式

#### 4.域关系演算语言QBE



## 第三章 关系数据库标准语言SQL

### 第一节 SQL概述

#### 1.SQL概述

目前，没有一个数据库系统能够支持SQL标准的所有概念和特性

#### 2.SQL的特点

SQL集==数据查询==(data query）、==数据操纵==(data manipulation)、==数据定义==(data definition）和==数据控制==（data control）功能于一体，其主要特点包括以下几部分。

- 综合统一
- 高度非过程化
- 面向集合的操作方式
- 以同一种语法结构提供多钟使用方式
- 语言简单，易学易用

#### 3.SQL的操作要求

- 定义和修改、删除关系模式，定义和删除视图，插入数据，建立数据库。
- 对数据库中的数据进行查询和更新。
- 数据库重构和维护。
- 数据库安全性、完整性控制，以及事务控制。
- 嵌入式SQL 和动态 SQL定义。

### 第三节 数据定义

#### 1.建表、建库等语句



### 第四节 数据查询

##### 带有比较运算符的子查询

##### 带有ANY (SOME）或ALL 谓词的子查询

子查询返回单值时可以用比较运算符，但返回多值时要用 ANY（有的系统用SOME)或ALL 谓词修饰符。而使用ANY或ALL 谓词时则必须同时使用比较运算符。

##### 带有EXISTS 谓词的子查询

##### 集合查询

SELECT 语句的查询结果是元组的集合，所以多个SELECT 语句的结果可进行集合操作。集合操作主要包括并操作 UNION、交操作INTERSECT和差操作EXCEPT。
*注意，参加集合操作的各查询结果的列数必须相同;对应项的数据类型也必须相同。*

##### 基于派生表的查询

子查询不仅可以出现在WHERE子句中，还可以出现在FROM子句中，这时子查询生成的临时派生表（derived table）成为主查询的查询对象。

```mysql
SELECT Sno,Cno
FROM SC,(SELECT Sno,Avg(Grade)FROM SC GROUP BY Sno)
AS Avg_sc(avg_sno,avg_grade)
WHERE SC.Sno=Avg_sc.avg_sno and SC.Grade >= Avg_sc.avg_grade
```

这里 FROM子句中的子查询将生成一个派生表Avg_sc。该表由avg_sno和 avg_grade两个属性组成，记录了每个学生的学号及平均成绩。主查询将SC表与Avg_sc按学号相等进行连接，选出修课成绩大于其平均成绩的课程号。



### 第五节 数据更新

#### 1.插入数据

插入数据可以插入一个元组，也可以插入子查询结果

##### 插入子查询结果

对每一个系，求学生的平均年龄，并把结果存入数据库。
首先在数据库中建立一个新表，其中一列存放系名，另一列存放相应的学生平均年龄。

```mysql
CREATE TABLE Dept_age
(Sdept CHAR(15)
Avg_age SMALLINT);
```

然后对Student表按系分组求平均年龄，再把系名和平均年龄存入新表中。

```mysql
INSERT
INTO Dept_age(Sdept,Avg_age)
SELECT Sdept,AVG(Sage)
FROM Student
GROUP BY Sdept;
```



### 第六节 空值的处理

#### 空值

> 所谓空值就是“不知道”或“不存在”或“无意义”的值。



### 第七节 视图

#### 1.视图

> 视图是从一个或几个基本表（或视图）导出的表。它与基本表不同，是一个虚表。数据库中只存放视图的定义，而不存放视图对应的数据，这些数据仍存放在原来的基本表中。
>
> 所以一旦基本表中的数据发生变化，从视图中查询出的数据也就随之改变了。从这个意义上讲，视图就像一个窗口，透过它可以看到数据库中自己感兴趣的数据及其变化。
>
> 视图一经定义，就可以和基本表一样被查询、被删除。也可以在一个视图之上再定义新的视图，但对视图的更新（增、删、改）操作则有一定的限制。

#### 2.视图消解

#### 3.行列子集视图、分组视图

#### 4.视图的作用

- 视图能够简化用户的操作
- 视图使用户能以多种角度看待同—数据
- 视图对重构数据库提供了一定程度的逻辑独立性
- 视图能够对机密数据提供安全保护
- 适当利用视图可以更清晰地表达查询



## 第四章 数据库安全性

### 第一节 数据库安全性概述

#### 1.数据库安全性

> 数据库的安全性是指保护数据库以防止不合法使用所造成的数据泄露、更改或破坏。

#### 2.数据库不全因素

- 非授权用户对数据库的恶意存取和破坏
- 数据库中重要或敏感的数据被泄露
- 安全环境的脆弱性

#### 

### 第五节 数据加密

#### 1.数据加密

加密的基本思想是根据一定的算法将原始数据——明文（plain text）变换为不可直接识别的格式——密文（cipher text)，从而使得不知道解密算法的人无法获知数据的内容。
数据加密主要包括==存储加密==和==传输加密==。

#### 

## 第五章 数据库完整性

> 数据库的完整性(integrity)是指数据的正确性(correctness)和相容性(compat- ability）。

#### 2.完整性和安全性

数据的完整性和安全性是两个既有联系又不尽相同的概念。

数据的完整性是为了防止数据库中存在不符合语义的数据，也就是防止数据库中存在不正确的数据。

数据的安全性是保护数据库防止恶意破坏和非法存取。

因此，完整性检查和控制的防范对象是不合语义
的、不正确的数据，防止它们进入数据库。安全性控制的防范对象是非法用户和非法操作，
防止他们对数据库数据的非法存取。

#### 3.为维护数据库的完整性，数据库管理系统必须能够实现如下功能

- 提供定义完整性约束条件的机制
- 提供完整性检查的方法
- 进行违约处理



### 第一节 实体完整性

#### 1.实体完整性检查

（1）检查主码值是否唯一，如果不唯一则拒绝插入或修改。
（2）检查主码的各个属性是否为空，只要有一个为空就拒绝插入或修改。



### 第二节 参照完整性

检查外码



### 第三节 用户定义的完整性

#### 1.属性上添加约束条件

#### 2.元组上添加约束条件



### 第四节 完整性约束命名子句



# 第二篇 设计与应用开发篇

## ==第六章 关系数据理论==

### 第一节 问题的提出

#### 1.问题

针对一个具体问题，应该如何构造一个适合于它的数据库模式？即应该构造几个关系模式，每个关系由哪些属性组成等。

因此，人们就以关系模型为背景来讨论这个问题，形成了数据库逻辑设计的一个有力工具——关系数据库的规范化理论。

#### 2.三范式

第一范式——每一个分量必须是不可分的数据项。

第二范式——每一个非主属性完全函数依赖于任何一个候选码。

第三范式——每一个非主属性既不传递依赖于码，也不部分依赖于码。

#### 3.==理解函数依赖和多值依赖==



#### 4.规范化

> 一个低一级范式的关系模式通过模式分解（schemadecomposition）可以转换为若干个高一级范式的关系模式的集合，这种过程就叫规范化（normalization）。



## 第七章 数据库设计

#### 1.数据库设计

> 数据库设计是指对于一个给定的应用环境，构造（设计）优化的数据库逻辑模式和物理结构，并据此建立数据库及其应用系统，使之能够有效地存储和管理数据，满足各种用户的应用需求，包括信息管理要求和数据操作要求。

#### 2.数据库设计的特点

#### 3.数据库设计的方法

##### 数据库的设计步骤

- 需求分析;
- 概念结构设计;
- 逻辑结构设计;
- 物理结构设计;
- 数据库实施;
- 数据库运行和维护

![image-20200728094510578](https://gitee.com/koala010/typora/raw/master/img/20200728094510.png)



![image-20200728095140249](https://gitee.com/koala010/typora/raw/master/img/20200728095140.png)



#### 4.需求分析

![image-20200728095725019](https://gitee.com/koala010/typora/raw/master/img/20200728095725.png)

最后，要强调两点:
（1）需求分析阶段的一个重要而困难的任务是收集将来应用所涉及的数据，设计人员应充分考虑到可能的扩充和改变，使设计易于更改、系统易于扩充。
（2）必须强调用户的参与，这是数据库应用系统设计的特点。

#### 5.数据字典

数据字典通常包括数据项、数据结构、数据流、数据存储和处理过程几部分。

数据项描述={数据项名，数据项含义说明，别名，数据类型，长度，取值范围,取值含义，与其他数据项的逻辑关系，数据项之间的联系}

#### 6.概念结构设计

> 将需求分析得到的用户需求抽象为信息结构（即概念模型)的过程就是概念结构设计。

##### 概念模型的主要特点是:

(1）能真实、充分地反映现实世界，包括事物和事物之间的联系，能满足用户对数据
的处理要求，是现实世界的一个真实模型。
(2）易于理解，可以用它和不熟悉计算机的用户交换意见。用户的积极参与是数据库
设计成功的关键。
(3）易于更改，当应用环境和应用要求改变时容易对概念模型修改和扩充。
(4）易于向关系、网状、层次等各种数据模型转换。

#### 7.E-R模型

##### 实体的联系

- 一对一
- 一对多
- 多对多

![image-20200728101016940](https://gitee.com/koala010/typora/raw/master/img/20200728101017.png)



![image-20200728101029496](https://gitee.com/koala010/typora/raw/master/img/20200728101029.png)



![image-20200728101037310](https://gitee.com/koala010/typora/raw/master/img/20200728101037.png)

##### E-R图

E-R图提供了表示实体型、属性和联系的方法。
（1）实体型用矩形表示，矩形框内写明实体名。
（2）属性用椭圆形表示，并用无向边将其与相应的实体型连接起来。
（3）联系用菱形表示，菱形框内写明联系名，并用无向边分别与有关实体型连接起来，同时在无向边旁标上联系的类型（1:1、1:n或m:n）。
*需要注意的是，如果一个联系具有属性，则这些属性也要用无向边与该联系连接起来。*

![image-20200728101255378](https://gitee.com/koala010/typora/raw/master/img/20200728101255.png)



##### E-R实例

物资管理涉及以下几个实体。
仓库:属性有仓库号、面积、电话号码;
零件:属性有零件号、名称、规格、单价、描述;
供应商:属性有供应商号、姓名、地址、电话号码、账号;
项目:属性有项目号、预算、开工日期;
职工:属性有职工号、姓名、年龄、职称。
这些实体之间的联系如下:
(1）一个仓库可以存放多种零件，一种零件可以存放在多个仓库中，因此仓库和零件具有多对多的联系。用库存量来表示某种零件在某个仓库中的数量。
(2）一个仓库有多个职工当仓库保管员，一个职工只能在一个仓库工作，因此仓库和职工之间是一对多的联系。
(3）职工之间具有领导与被领导关系，即仓库主任领导若干保管员，因此职工实体型中具有一对多的联系。
(4）供应商、项目和零件三者之间具有多对多的联系，即一个供应商可以供给若干项目多种零件，每个项目可以使用不同供应商供应的零件，每种零件可由不同供应商供给。

![image-20200728102047336](https://gitee.com/koala010/typora/raw/master/img/20200728102047.png)

##### ISA联系

用E-R方法构建一个项目的模型时，经常会遇到某些实体型是某个实体型的子类型。例如，研究生和本科生是学生的子类型，学生是父类型。这种父类-子类联系称为ISA 联系，表示“is a”的语义。例如，图7.12中研究生is a学生，本科生is a学生。ISA联系用三角形来表示。



ISA联系一个重要的性质是子类继承了父类的所有属性，当然子类也可以有自己的属性。例如，本科生和研究生是学生实体的子类型，他们具有学生实体的全部属性，研究生子实体型还有“导师姓名”和“研究方向”两个自己的属性。ISA联系描述了对一个实体型中实体的一种分类方法，下面对分类方法做进一步说明。



（1）分类属性
根据分类属性的值把父实体型中的实体分派到子实体型中。例如图7.12中，在ISA联系符号三角形的右边加了一个分类属性“学生类别”，它说明一个学生是研究生还是本科生由“学生类别”这个分类属性的值决定。

![image-20200728102608554](https://gitee.com/koala010/typora/raw/master/img/20200728102608.png)

(2）不相交约束与可重叠约束
不相交约束描述父类中的一个实体不能同时属于多个子类中的实体集，即一个父类中的实体最多属于一个子类实体集，用ISA联系三角形符号内加一个叉号“X”来表示。例如，图7.13表明一个学生不能既是本科生又是研究生。如果父类中的一个实体能同时属于多个子类中的实体集，则称为可重叠约束，子类符号中没有叉号表示是可重叠的。

![image-20200728102702846](https://gitee.com/koala010/typora/raw/master/img/20200728102702.png)

(3）完备性约束
完备性约束描述父类中的一个实体是否必须是某一个子类中的实体，如果是，则叫做完全特化（total specialization)，否则叫做部分特化（partial specialization）。完全特化用父类到子类的双线连接来表示，单线连接则表示部分特化。假设学生只有两类，要么是本科生，要么是研究生，二者必居其一，这就是完全特化的例子，如图7.13所示。

##### 基数约束



##### Part of联系



#### 9.概念结构设计

##### 实体与属性的划分原则

为了简化E-R图的处置，现实世界的事物能作为属性对待的尽量作为属性对待。

(1）作为属性，不能再具有需要描述的性质，即属性必须是不可分的数据项，不能包含其他属性。
(2）属性不能与其他实体具有联系，即E-R图中所表示的联系是实体之间的联系。



*例如，职工是一个实体，职工号、姓名、年龄是职工的属性，职称如果没有与工资、岗位津贴、福利挂钩，换句话说，没有需要进一步描述的特性，则根据准则(1）可以作为职工实体的属性;但如果不同的职称有不同的工资、岗位津贴和不同的附加福利，则职称作为一个实体看待就更恰当。*

*又如，在医院中一个病人只能住在一个病房，病房号可以作为病人实体的一个属性;但如果病房还要与医生实体发生联系，即一个医生负责几个病房的病人的医疗工作，则根据准则（2）病房应作为一个实体*

#### 10.E-R图的集成

在开发一个大型信息系统时，最经常采用的策略是自顶向下地进行需求分析，然后再自底向上地设计概念结构。即首先设计各子系统的分E-R图，然后将它们集成起来，得到全局E-R图。E-R图的集成一般需要分两步走，如图7.24所示。

![image-20200728105750589](https://gitee.com/koala010/typora/raw/master/img/20200728105750.png)



各子系统的E-R图之间的冲突主要有三类:==属性冲突==、==命名冲突==和==结构冲突==。

#### 11.逻辑结构设计

> 概念结构是独立于任何一种数据模型的信息结构，逻辑结构设计的任务就是把概念结构设计阶段设计好的基本E-R图转换为与选用数据库管理系统产品所支持的数据模型相符合的逻辑结构。

可以将经常使用的属性水平分解，形成子关系，提高访问效率。



#### 12.物理结构设计

##### B+树索引存取方法的选择

（1）如果一个（或一组）属性经常在查询条件中出现，则考虑在这个（或这组）属性上建立索引（或组合索引）。
（2）如果一个属性经常作为最大值和最小值等聚集函数的参数，则考虑在这个属性上建立索引。
（3）如果一个（或一组）属性经常在连接操作的连接条件中出现，则考虑在这个(或这组）属性上建立索引。

##### hash索引存取方法的选择

##### 聚簇存取方法的选择



## 第八章 数据库编程

#### 1.嵌入式SQL

> 嵌入式SQL是将SQL语句嵌入程序设计语言中，被嵌入的程序设计语言，如C、C++、Java 等称为宿主语言，简称主语言。

##### 嵌入式SQL的通信

数据军工作单元与源程序工作单元之间的通信主要包括:
(1）向主语言传递SQL 语句的执行状态信息，使主语言能够据此信息控制程序流程，主要用SQL通信区（SQL Communication Area，sQLCA）实现。
(2）主语言向SQL语句提供参数，主要用主变量（host variable）实现。
(3）将SQL语句查询数据库的结果交主语言处理，主要用主变量和游标（cursor）实现。

SQL通信区在应用程序中用EXEC SQL INCLUDE SQLCA加以定义。**SQL通信区中有一个变量SQLCODE，用来存放每次执行SQL 语句后返回的代码。**

##### 主变量和指示变量

#### 2.游标

> 游标是系统为用户开设的一个数据缓冲区，存放SQL语句的执行结果，每个游标区都有一个名字。用户可以通过游标逐一获取记录并赋给主变量，交由主语言进一步处理。

#### 3.动态SQL

#### 4.过程化SQL

#### 5.存储过程和函数

#### 6.ODBC

#### 7.OLE DB

#### 8.JDBC



# 第三篇 系统篇

## 第九章 关系查询处理和查询优化

#### 1.查询处理

> 查询处理是关系数据库管理系统执行查询语句的过程，其任务是把用户提交给关系数据库管理系统的查询语句转换为高效的查询执行计划。

关系数据库管理系统查询处理可以分为4个阶段:查询分析、查询检查、查询优化和查询执行。

#### 2.选择操作的实现

##### 全表扫描算法

##### 索引扫描算法

#### 3.连接操作的实现

##### 嵌套循环算法

##### 排序-合并算法

##### 索引连接算法

##### hash join算法

#### 4.查询优化

##### 优点：

查询优化的优点不仅在于用户不必考虑如何最好地表达查询以获得较高的效率，而且在于。

##### 系统可以比用户程序的“优化”做得更好的原因：

(1）优化器可以从数据字典中获取许多统计信息，例如每个关系表中的元组数、关系中每个属性值的分布情况、哪些属性上已经建立了索引等。优化器可以根据这些信息做出正确的估算，选择高效的执行计划，而用户程序则难以获得这些信息。io irsit
(2）如果数据库的物理统计信息改变了，系统可以自动对查询进行重新优化以选择相适应的执行计划。在非关系系统中则必须重写程序，而重写程序在实际应用中往往是不太可能的。
(3）优化器可以考虑数百种不同的执行计划，而程序员一般只能考虑有限的几种可能性。
(4）优化器中包括了很多复杂的优化技术，这些优化技术往往只有最好的程序员才能掌握。系统的自动优化相当于使得所有人都拥有这些优化技术。

##### 总代价

总代价=IO代价+CPU 代价+内存代价+通信代价

#### 5.代数优化

#### 6.查询树的启发式优化

#### 7.物理优化

##### 基于启发式规则的存取路径选择优化

##### 基于代价估算的优化

#### 8.查询计划的执行



## 第十章 数据库恢复技术

#### 1.事务

> 所谓事务是用户定义的一个数据库操作序列，这些操作要么全做，要么全不做，是一个不可分割的工作单位。

#### 2.故障的种类

1.事务内部故障——事务撤销

2.系统故障——强制撤销未完成的事务（回滚），并重做

3.介质故障（磁盘等损害，破坏性最大）

4.计算机病毒

总结各类故障对数据库的影响有两种可能性，一是数据库本身被破坏，二是数据库没有被破坏，但数据可能不正确，这是由于事务的运行被非正常终止造成的。

#### 3.恢复的实现技术

##### 数据转存

##### 登记日志文件

#### 4.恢复策略

#### 5.具有检查点的恢复技术

##### 检查点

#### 6.数据库镜像



## 第十一章 并发控制

#### 1.交叉并发方式、同时并发方式

#### 2.并发控制概述

事务是并发控制的基本单位

并发控制的主要技术有封锁（locking）、时间戳（timestamp）、乐观控制法（optimisticscheduler）和多版本并发控制（multi-version concurrency control，MVCC）等。

#### 3.封锁

> 所谓封锁就是事务T在对某个数据对象例如表、记录等操作之前，先向系统发出请求，对其加锁。加锁后事务T就对该数据对象
>
> 有了一定的控制，在事务T释放它的锁之前，其他事务不能更新此数据对象。

##### 排他锁

排他锁又称为写锁。若事务T对数据对象A加上X锁，则只允许T读取和修改A，其他任何事务都不能再对A加任何类型的锁，直到T释放A上的锁为止。这就保证了其他事务在T释放A上的锁之前不能再读取和修改A。

##### 共享锁

共享锁又称为读锁。若事务T对数据对象A加上S锁，则事务T可以读A但不能修改A，其他事务只能再对A加S锁，而不能加X锁，直到T释放A上的S锁为止。这就保证了其他事务可以读A，但在T释放A上的S锁之前不能对A做任何修改。

##### 封锁协议

###### 1—级封锁协议

> 一级封锁协议是指，事务T在修改数据R之前必须先对其加X锁，直到事务结束才释放。

事务结束包括正常结束（COMMIT）和非正常结束（ROLLBACK）。

在一级封锁协议中，如果仅仅是读数据而不对其进行修改，是不需要加锁的，所以它不能保证可重复读和不读“脏”数据。

###### 2.二级封锁协议

> 二级封锁协议是指，在一级封锁协议基础上增加事务T在读取数据R之前必须先对其加S锁，读完后即可释放S锁。

在二级封锁协议中，由于读完数据后即可释放S锁，所以它不能保证可重复读。

###### 3.三级封锁协议

> 三级封锁协议是指，在一级封锁协议的基础上增加事务T在读取数据R之前必须先对其加S锁，直到事务结束才释放。

#### 4.活锁和死锁

和操作系统一样，封锁的方法可能引起活锁和死锁等问题。

##### 活锁

如果事务T封锁了数据R，事务T2又请求封锁R，于是T2等待;T3也请求封锁R,当T1释放了R上的封锁之后系统首先批准了T3的请求，T2仍然等待;然后T4又请求封锁R，当T3释放了R上的封锁之后系统又批准了T4的请求……T2有可能永远等待，这就是活锁的情形。

###### 避免活锁

避免活锁的简单方法是采用==先来先服务==的策略。当多个事务请求封锁同一数据对象时，封锁子系统按请求封锁的先后次序对事务排队，数据对象上的锁一旦释放就批准申请队列中第一个事务获得锁。

##### 死锁

如果事务T1封锁了数据R，T2封锁了数据R2，然后T1又请求封锁R2，因T2已封锁了R2，于是T1等待T释放R上的锁;接着T2又申请封锁R1，因T1已封锁了R1，T2也只能等待T1释放R1上的锁。这样就出现了T1，在等待T2，而T2又在等待T1的局面，T和T两个事务永远不能结束，形成死锁。

###### 避免死锁

**（1）一次封锁法**
一次封锁法要求每个事务必须一次将所有要使用的数据全部加锁，否则就不能继续执行。如果事务T1将数据对象R1和R2一次加锁，T1就可以执行下去，而T2等待。T1执行完后释放R1、R2上的锁，T2继续执行。这样就不会发生死锁。

一次封锁法虽然可以有效地防止死锁的发生，但也存在问题，

第一，一次就将以后要用到的全部数据加锁，势必扩大了封锁的范围，从而降低了系统的并发度;

第二，数据库中数据是不断变化的，原来不要求封锁的数据在执行过程中可能会变成封锁对象，所以很难事先精确地确定每个事务所要封锁的数据对象，为此只能扩大封锁范围，将事务在执行过程中可能要封锁的数据对象全部加锁，这就进一步降低了并发度。

**（2）顺序封锁法**
顺序封锁法是预先对数据对象规定一个封锁顺序，所有事务都按这个顺序实施封锁。例如在B树结构的索引中，可规定封锁的顺序必须是从根结点开始，然后是下一级的子结点，逐级封锁。

顺序封锁法可以有效地防止死锁，但也同样存在问题，

第一，数据库系统中封锁的数据对象极多，并且随数据的插入、删除等操作而不断地变化，要维护这样的资源的封锁顺序非常困难，成本很高;

第二，事务的封锁请求可以随着事务的执行而动态地决定，很难事先确定每一个事务要封锁哪些对象，因此也就很难按规定的顺序去施加封锁。

可见，在操作系统中广为采用的预防死锁的策略并不太适合数据库的特点，因此数据库管理系统在解决死锁的问题上普遍采用的是**诊断并解除死锁的方法。**



###### 死锁的诊断与解除

（1）超时法
如果一个事务的等待时间超过了规定的时限，就认为发生了死锁。超时法实现简单，但其不足也很明显，一是有可能误判死锁，如事务因为其他原因而使等待时间超过时限，系统会误认为发生了死锁;二是时限若设置得太长，死锁发生后不能及时发现。

（2）等待图法
事务等待图是一个有向图G=(T，U)，T为结点的集合，每个结点表示正运行的事务;U为边的集合，每条边表示事务等待的情况。若T
等待T，则在T、T之间画一条有向边，从T指向T。如图11.6所示。

![image-20200728205910503](https://gitee.com/koala010/typora/raw/master/img/20200728205910.png)



#### 5.并发调度的可串行性

#### 可串行性

> 定义多个事务的并发执行是正确的，当且仅当其结果与按某一次序串行地执行这些事务时的结果相同，称这种调度策略为可串行化（serializable）调度。

可串行性（serializability）是并发事务正确调度的准则。按这个准则规定，一个给定的并发调度，当且仅当它是可串行化的，才认为是正确调度。

#### 6.冲突可串行化调度

冲突操作是指不同的事务对同一个数据的读写操作和写写操作:

R;(x)与 W(x)      /*事务T读x，T写x，其中i≠j*/
W(x)与 W(x)    /*事务T写x，T写x，其中i≠j*/

#### 7.两段锁协议

所谓两段锁协议是指所有事务必须分两个阶段对数据项加锁和解锁。

- 在对任何数据进行读、写操作之前，首先要申请并获得对该数据的封锁;
- 在释放一个封锁之后，事务不再申请和获得任何其他封锁。

**需要说明的是，事务遵守两段锁协议是可串行化调度的充分条件，而不是必要条件。**

#### 8.多粒度封锁

#### 9.意问锁

> 意向锁的含义是如果对一个结点加意向锁，则说明该结点的下层结点正在被加锁;任一结点加锁时，必须先对它的上层结点加意向锁。

##### IS锁

> 如果对一个数据对象加IS锁，表示它的后裔结点拟（意向）加S锁。

例如，事务T要对R中某个元组加S锁，则要首先对关系R和数据库加IS锁。

##### IX锁

> 如果对一个数据对象加IX锁，表示它的后裔结点拟（意向）加X锁。

例如，事务T要对R中某个元组加X锁，则要首先对关系R和数据库加IX锁。

##### SIX锁

> 如果对一个数据对象加SIX锁，表示对它加S锁，再加IX锁，即 SIX=S+IX。

例如对某个表加 SIX锁，则表示该事务要读整个表（所以要对该表加S锁)，同时会更新个别元组（所以要对该表加IX锁)。

#### 10.时间戳方法

时间戳方法给每一个事务盖上一个时标，即事务开始执行的时间。每个事务具有唯一的时间戳，并按照这个时间戳来解决事务的冲突操作。如果发生冲突操作，就回滚具有较早时间戳的事务，以保证其他事务的正常执行，被回滚的事务被赋予新的时间戳并从头开始执行。

#### 11.乐观控制法

乐观控制法认为事务执行时很少发生冲突，因此不对事务进行特殊的管制，而是让它自由执行，事务提交前再进行正确性检查。如果检查后发现该事务执行中出现过冲突并影响了可串行性，则拒绝提交并回滚该事务。乐观控制法又被称为验证方法（certifier)。

#### 12.多版本并发控制

多版本并发控制（MultiVersion Concurrency Control，MVCC）是指在数据库中通过维护数据对象的多个版本信息来实现高效并发控制的一种策略。

##### 版本

> 版本(version）是指数据库中数据对象的一个快照，记录了数据对象某个时刻的状态。

如果在T准备写A时不是等待，而是为A生成一个新的版本（表示为A')，那么T2就可以继续在A'上执行。只是在T2准备提交的时候要检查一下事务T是否已经完成。如果T已经完成了，T2就可以放心地提交;如果T还没有完成，那么T2必须等待直到T完成。这样既能保持事务执行的可串行性，又提高了事务执行的并行度。

##### 优点

多版本并发控制和封锁机制相比，主要的好处是消除了数据库中数据对象读和写操作的冲突，有效地提高了系统的性能。

##### 难题

多版本并发控制方法有利于提高事务的并发度，但也会产生大量的无效版本，而且在事务结束时刻，其所影响的元组的有效性不能马上确定，这就为保存事务执行过程中的状态提出了难题。这些都是实现多版本并发控制的一些关键技术。

##### 改进

多版本协议可以进一步改进。区分事务的类型为只读事务和更新事务。对于只读事务，发生冲突的可能性很小，可以采用多版本时间戳。对于更新事务，采用较保守的两阶段封锁（2PL）协议。这样的混合协议称为MV2PL。



## 第十二章 数据库管理系统

#### 1.数据库管理系统的基本功能

- 数据库定义和创建

- 数据组织、存储和管理
- 数据存取
- 数据库事务管理和运行管理
- 数据库的建立和维护
- 其他功能

#### 2.层次结构

![image-20200729084927092](https://gitee.com/koala010/typora/raw/master/img/20200729084927.png)

#### 3.系统缓冲区

##### 设立原因：

一是它把数据存储层以上各系统成分和实际的外存设备隔离，外存设备的变更不会影响其他系统成分，使关系数据库管理系统具有设备独立性;

二是提高存取效率。



# 第四篇 新技术篇

## 第13章 数据库技术发展概述

#### 1.数据库、数据库系统、数据库技术的发展趋势

#### 2.NoSQL

> NoSQL是指非关系型的、分布式的、不保证满足ACID 特性的一类数据管理系统。

##### NoSQL技术有如下特点:

（1）对数据进行划分（partitioning)，通过大量节点的并行处理获得高性能，采用的是横向扩展的方式(scale out)。
（2）放松对数据的ACID一致性约束，允许数据暂时出现不一致情况，接受最终一致性（eventual consistency)。即 NoSQL 遵循BASE （Basically Available，Soft state,Eventual consistency）原则，这是一种弱一致性（weak consistency）约束框架。
	其中，Basically Available（基本可用）是指可以容忍数据短期不可用，并不强调全天候服务;Soft state（柔性状态）是指状态可以有一段时间不同步，存在异步的情况;Eventually consistent（最终一致）是指最终数据一致，而不是严格的一致。
（3）对各个数据分区进行备份（一般是三份)，应对节点可能的失败，提高系统可用性等。

##### 分类

NoSQL 技术依据存储模型可分为基于Key-Value存储模型、基于Column Family(列分组）存储模型、基于文档模型和基于图模型的NoSQL数据库技术4类。



## 第14章 大数据管理

#### 1.大数据的特征

巨量( Volume）、多样（Variety）、快变（Velocity）、价值（Value）

## 第15章 内存数据库系统

#### 1.内存数据库

> 内存数据库（Main Memory DataBase，MMDB）系统是指将数据库的全部或大部分数据放在内存中的数据库系统[1]。其实现技术的研究始于20世纪80年代，目的是有效利用内存的优势，提高数据库的性能。



## 第16章 数据仓库与联机分析处理技术



